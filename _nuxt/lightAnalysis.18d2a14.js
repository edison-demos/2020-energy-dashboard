(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{226:function(t,e,r){"use strict";r.d(e,"c",(function(){return h})),r.d(e,"b",(function(){return y})),r.d(e,"i",(function(){return m})),r.d(e,"a",(function(){return v})),r.d(e,"d",(function(){return x})),r.d(e,"e",(function(){return D})),r.d(e,"f",(function(){return C})),r.d(e,"j",(function(){return w})),r.d(e,"g",(function(){return k})),r.d(e,"h",(function(){return A}));r(48),r(2),r(35),r(42),r(18),r(19),r(68);var n=r(29),o=(r(3),r(1),r(91),r(92),r(12),r(225)),l=r.n(o),c=r(228);function d(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return l=t.done,t},e:function(t){c=!0,o=t},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var h=["#cd256f","#ef9424","#20a7d9","#79b045","#89328a","#086db0","#c7def8","#fc2929","#fad8c7","#fbca04","#84b6eb","#00cccc","#159818","#eb6420","#bfe5bf","#f7c6c7","#d4c5f9","#cc317c","#207de5","#b1eadc"],y=[{name:"總輸入功率",key:"active_power",diffMode:!1,sumary:!0},{name:"總輸出功率",key:"loadside_power",diffMode:!1,sumary:!0},{name:"總視在功率",key:"apparent_power",diffMode:!1,sumary:!0},{name:"平均亮度",key:"device_arc",diffMode:!1,sumary:!1},{name:"平均使用時間率",key:"light_source_on_time",diffMode:!0,sumary:!1},{name:"平均能耗使用率(輸出)",key:"output_usage",diffMode:!1,sumary:!0},{name:"平均能耗使用率(輸入)",key:"input_usage",diffMode:!1,sumary:!0},{name:"啟動總次數",key:"light_source_start_count",diffMode:!0,sumary:!1},{name:"驅動器最高溫度",key:"control_gear_temperature",sumary:!1,maxMode:!0},{name:"平均頻率",key:"control_gear_voltage_frequence",sumary:!1},{name:"平均輸入電壓",key:"control_gear_voltage",sumary:!1},{name:"平均功率因數",key:"control_gear_power_factor",sumary:!1}];function _(t,e,r){var n=l()(e.created_at),o=l()(t.created_at),c=l.a.duration(o.diff(n)).asSeconds();return Math.min(100,100*(t[r]-e[r])/c)}function m(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],f=0,m={datasets:[]},v=r.gears.map((function(g){return g.id})),x=v.reduce((function(e,r){return t[e].length>t[r].length?e:r})),D=v.length,C=r.gears.map((function(g){return g.power_out})).reduce((function(a,b){return a+b})),w=r.gears.map((function(g){return g.power_in})).reduce((function(a,b){return a+b})),k=d(y);try{for(k.s();!(e=k.n()).done;){var A,I=e.value,Y=I.name,M=I.key,O=I.sumary,S=I.diffMode,j=I.maxMode,F=I.yAxisID,P=[],R=d(t[x].entries());try{for(R.s();!(A=R.n()).done;){var $=Object(n.a)(A.value,2),T=$[0],G=$[1],E=l()(G.created_at),L=T+1;if(t[x][L]){var z,J=[],W=0,U=d(v);try{for(U.s();!(z=U.n()).done;){var B=z.value,H=t[B][T],K=t[B][L];if(H&&K){J.push(H[M]);var N=H[M];S&&(N=H[M]-K[M]),M.includes("on_time")&&(N=_(H,K,M)),"device_arc"===M&&(N=c.a[N]),"output_usage"===M&&(N=H.loadside_power),"input_usage"===M&&(N=H.active_power),W+=N}}}catch(t){U.e(t)}finally{U.f()}var Q=W;O||(Q=W/D),"output_usage"===M&&(Q=W/C*100),"input_usage"===M&&(Q=W/w*100),j&&(Q=Math.max.apply(Math,J)),P.push({x:E.format(),y:Q.toFixed(2)})}}}catch(t){R.e(t)}finally{R.f()}o.includes(f)?f++:m.datasets.push({yAxisID:F,label:Y,fill:!1,tension:0,borderColor:h[f++],data:[].concat(P)})}}catch(t){k.e(t)}finally{k.f()}return m}var v=["輸入耗能","視在耗能","負載耗能","平均啟動次數","平均使用率","平均亮度"];function x(t,e,r){var n,o=e.gears.map((function(g){return g.id})),c=o.reduce((function(e,r){return t[e].length>t[r].length?e:r})),f=[],y=[],m=[],v=[],x=[],D=[],C=!0,w=d(t[c]);try{var k=function(){var e=n.value;if(C)return C=!1,"continue";var r,c=l()(e.created_at),h=l()(e.created_at).subtract(1,"day"),w={l0:0,l1:0,l2:0},k=0,A=0,I=0,Y=d(o);try{for(Y.s();!(r=Y.n()).done;){var M=r.value,O=t[M].find((function(t){return c.isSame(t.created_at,"day")})),S=t[M].find((function(t){return h.isSame(t.created_at,"day")}));O&&S&&(w.l0+=O.active_energy-S.active_energy,w.l1+=O.apparent_energy-S.apparent_energy,w.l2+=O.loadside_energy-S.loadside_energy,k+=_(O,S,"light_source_on_time"),A+=O.light_source_start_count-S.light_source_start_count,I+=O.device_arc)}}catch(t){Y.e(t)}finally{Y.f()}f.push({x:c.format("YYYY-MM-DD"),y:(w.l0/o.length).toFixed(2)}),y.push({x:c.format("YYYY-MM-DD"),y:(w.l1/o.length).toFixed(2)}),m.push({x:c.format("YYYY-MM-DD"),y:(w.l2/o.length).toFixed(2)}),v.push({x:c.format("YYYY-MM-DD"),y:(A/o.length).toFixed(0)}),x.push({x:c.format("YYYY-MM-DD"),y:(k/o.length).toFixed(0)}),D.push({x:c.format("YYYY-MM-DD"),y:(I/o.length).toFixed(2)})};for(w.s();!(n=w.n()).done;)k()}catch(t){w.e(t)}finally{w.f()}return{datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入耗能",data:f},{yAxisID:"a",borderColor:h[1],fill:!1,tension:0,label:"視在耗能",data:y},{yAxisID:"a",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:m},{yAxisID:"d",borderColor:h[3],fill:!1,tension:0,label:"平均啟動次數",data:v},{yAxisID:"e",borderColor:h[4],fill:!1,tension:0,label:"平均使用率",data:x},{yAxisID:"f",borderColor:h[5],fill:!1,tension:0,label:"平均亮度",data:D}].filter((function(t,e){return!r.includes(e)}))}}function D(t,e,r,n){var o=e.gears.map((function(g){return g.id})),l=[],c=Array(24).keys();r&&(c=Array(7).keys());var f,y=[],_=[],m=[],v=[],x=[],D=[],C=d(c);try{for(C.s();!(f=C.n()).done;){var w=f.value;l.push(w);var k,A={l0:0,l1:0,l2:0},I=0,Y=0,M=0,O=d(o);try{for(O.s();!(k=O.n()).done;){var S=k.value;t[S]&&(A.l0+=t[S][w].active_energy,A.l1+=t[S][w].apparent_energy,A.l2+=t[S][w].loadside_energy,I+=t[S][w].light_source_on_time,Y+=t[S][w].light_source_start_count,M+=t[S][w].device_arc)}}catch(t){O.e(t)}finally{O.f()}y.push((A.l0/o.length).toFixed(2)),_.push((A.l1/o.length).toFixed(2)),m.push((A.l2/o.length).toFixed(2)),v.push((Y/o.length).toFixed(0)),x.push((I/o.length).toFixed(0)),D.push((M/o.length).toFixed(2))}}catch(t){C.e(t)}finally{C.f()}return r&&(l=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"]),{labels:l,datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入耗能",data:y},{yAxisID:"a",borderColor:h[1],fill:!1,tension:0,label:"視在耗能",data:_},{yAxisID:"a",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:m},{yAxisID:"d",borderColor:h[3],fill:!1,tension:0,label:"平均啟動次數",data:v},{yAxisID:"e",borderColor:h[4],fill:!1,tension:0,label:"平均使用率",data:x},{yAxisID:"f",borderColor:h[5],fill:!1,tension:0,label:"平均亮度",data:D}].filter((function(t,e){return!n.includes(e)}))}}function C(t,e){var r=[],n=0,o=e?{device_arc:"　亮度　",light_source_voltage:"　輸出電壓　",light_source_current:"　輸出電流　",light_source_temperature:"　光源溫度　",light_source_start_count:"　輸出啟動次數　",light_source_on_time:"　輸出啟動時間　"}:{light_source_faiture_count:"輸出錯誤次數",light_source_short_count:"輸出短路次數",light_source_open_count:"輸出開路次數",light_source_thermal_derating_count:"光源降載次數",light_source_thermal_shutdown_count:"光源過熱關閉次數"},d=function(d){var label=o[d],f=[];t.forEach((function(e,i){if(t[i+1]){var r=l()(e.created_at),n=e[d];"device_arc"===d&&(n=c.a[n]),f.push({x:r.format(),y:n})}}));var _={label:label,fill:!1,tension:0,borderColor:h[n++],data:[].concat(f)};e&&(_.yAxisID=y[n].yAxisID),r.push(_)};for(var f in o)d(f);return{datasets:r}}var w=["輸入電壓","輸入電壓頻率","負載耗能"];function k(t,e,r){var n,o=e.gears.map((function(g){return g.id})),c=o.reduce((function(e,r){return t[e].length>t[r].length?e:r})),f=[],y=[],_=[],m=0,v=d(t[c]);try{var x=function(){var e,r=n.value,c=l()(r.created_at),h={l0:0,l1:0,l2:0},v=d(o);try{for(v.s();!(e=v.n()).done;){var x=e.value,D=t[x].find((function(t){return c.isSame(t.created_at,"day")}));D&&(h.l0+=D.control_gear_voltage,h.l1+=D.control_gear_voltage_frequence,h.l2+=D.loadside_energy)}}catch(t){v.e(t)}finally{v.f()}f.push({x:c.format("YYYY-MM-DD"),y:(h.l0/o.length).toFixed(2)}),y.push({x:c.format("YYYY-MM-DD"),y:(h.l1/o.length).toFixed(2)});var C=h.l2/o.length,w=C-m;m=C,_.push({x:c.format("YYYY-MM-DD"),y:w.toFixed(2)})};for(v.s();!(n=v.n()).done;)x()}catch(t){v.e(t)}finally{v.f()}y.shift(),_.shift(),f.shift();var D={datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入電壓",data:f},{yAxisID:"b",borderColor:h[1],fill:!1,tension:0,label:"輸入電壓頻率",data:y},{yAxisID:"c",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:_}]};return D.datasets=D.datasets.filter((function(t,e){return!r.includes(e)})),D}function A(t,e,r,n){var o=e.gears.map((function(g){return g.id})),l=[],c=Array(24).keys();r&&(c=Array(7).keys());var f,y=[],_=[],m=[],v=d(c);try{for(v.s();!(f=v.n()).done;){var x=f.value;l.push(x);var D,C={l0:0,l1:0,l2:0},w=d(o);try{for(w.s();!(D=w.n()).done;){var k=D.value;t[k]&&(C.l0+=t[k][x].control_gear_voltage,C.l1+=t[k][x].control_gear_voltage_frequence,C.l2+=t[k][x].loadside_energy)}}catch(t){w.e(t)}finally{w.f()}y.push((C.l0/o.length).toFixed(2)),_.push((C.l1/o.length).toFixed(2)),m.push((C.l2/o.length).toFixed(2))}}catch(t){v.e(t)}finally{v.f()}return r&&(l=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"]),{labels:l,datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入電壓",data:y},{yAxisID:"b",borderColor:h[1],fill:!1,tension:0,label:"輸入電壓頻率",data:_},{yAxisID:"c",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:m}].filter((function(t,e){return!n.includes(e)}))}}},227:function(t,e,r){"use strict";r.r(e);var n=r(229),o=(r(226),{mixins:[n.c.reactiveProp],extends:n.b,props:["options"],mounted:function(){this.renderLineChart()},methods:{renderLineChart:function(){this.renderChart(this.chartData,this.options)}},watch:{options:{deep:!0,handler:function(){this.renderChart(this.chartData,this.options)}}}}),l=r(34),component=Object(l.a)(o,void 0,void 0,!1,null,null,null);e.default=component.exports},232:function(t,e,r){var content=r(382);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(50).default)("1080d623",content,!0,{sourceMap:!1})},381:function(t,e,r){"use strict";var n=r(232);r.n(n).a},382:function(t,e,r){(e=r(49)(!1)).push([t.i,".s-name[data-v-2769c6e5]{margin-top:30px}.spliter[data-v-2769c6e5]{padding-top:20px}.card[data-v-2769c6e5]{margin:10px 0;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}",""]),t.exports=e},408:function(t,e,r){"use strict";r.r(e);r(5),r(2),r(3),r(1),r(4),r(12),r(68),r(43);var n=r(10),o=r(0),l=r(226),c=r(56),d=r(225),f=r.n(d);function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function y(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var _={data:function(){return{startDate:f()(new Date).subtract(1,"month").toISOString(),endDate:new Date,loading:!1,activeRegionIndex:0,seletedGearID:0,errorPoints:null,checkPoint:null,dayShift:0,dayChartData:{},hourChartData:{},weekChartData:{},dayChartOptions:{maintainAspectRatio:!1,legend:{position:"right",align:"end"},title:{display:!0,text:"異常次數圖",fontSize:16},scales:{yAxes:l.b.map((function(t){return{display:!1}})),xAxes:[{type:"time",distribution:"series",time:{unit:"day"}}]}},hourChartOptions:{maintainAspectRatio:!1,title:{display:!0,text:"區間小時統計圖",fontSize:16},legend:{position:"right",align:"end"},scales:{yAxes:l.b.map((function(t){return{id:t.yAxisID,display:!1}})),xAxes:[{type:"time",distribution:"series",time:{unit:"day"}}]}}}},computed:y(y({},Object(c.b)(["regions","status","config","gears"])),{},{regionOption:function(){return this.regions.map((function(t,e){return y(y({},t),{},{index:e})}))},gearsInRegion:function(){var t=this.regionOption[this.activeRegionIndex];return t?t.gears:[]}}),methods:{human:function(t){return f()(t).format("YYYY-MM-DD hh:mm:ss")},search:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=parseInt(t.seletedGearID),n=t.gears.find((function(g){return g.id===r})),e.next=4,t.$axios.$get("errors/light-search",{params:{id:n.id,start_at:new Date(t.startDate).getTime(),end_at:new Date(t.endDate).getTime()}});case 4:o=e.sent,t.errorPoints=o;case 6:case"end":return e.stop()}}),e)})))()},startAnalysis:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.dayShift=r.dayShift+e,0===e&&(r.dayShift=0),r.checkPoint=t,r.loading=!0,o=r.gears.find((function(g){return g.id===r.seletedGearID})),r.dayChartOptions.title.text="".concat(o.name," 異常次數圖"),c=f()(t.created_at).add("day",r.dayShift).toDate().getTime(),n.next=9,r.$axios.$get("errors/point-data",{params:{id:o.id,created_at:c}});case 9:d=n.sent,console.log(d),r.loading=!1,r.dayChartData=Object(l.f)(d),r.hourChartData=Object(l.f)(d,!0);case 14:case"end":return n.stop()}}),n)})))()}},mounted:function(){console.log(this.$route.hash),this.activeRegionIndex=this.$route.hash.substring(1,2),this.seletedGearID=this.$route.hash.substring(3)}},m=(r(381),r(34)),component=Object(m.a)(_,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"mt-2"},[r("b-row",[r("b-col",[r("h2",{staticClass:"s-name text-center"},[t._v("光源異常分析")])])],1),r("b-row",{staticClass:"mt-3",attrs:{"align-v":"end"}},[r("b-col",[r("label",{attrs:{for:"start-datepicker"}},[t._v("Start date")]),r("b-form-datepicker",{staticClass:"md-2",attrs:{id:"start-datepicker"},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}})],1),r("b-col",[r("label",{attrs:{for:"end-datepicker"}},[t._v("End date")]),r("b-form-datepicker",{staticClass:"md-2",attrs:{id:"end-datepicker"},on:{"":function(t){}},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1)],1),r("b-row",{staticClass:"mt-3"},[r("b-col",[r("b-form-select",{attrs:{"text-field":"name","value-field":"index",options:t.regionOption,_change:"startAnalysis"},model:{value:t.activeRegionIndex,callback:function(e){t.activeRegionIndex=e},expression:"activeRegionIndex"}})],1),r("b-col",[r("b-form-select",{attrs:{"text-field":"name","value-field":"id",options:t.gearsInRegion,_change:"startAnalysis"},model:{value:t.seletedGearID,callback:function(e){t.seletedGearID=e},expression:"seletedGearID"}})],1),r("b-col",{attrs:{cols:"1"}},[r("b-button",{attrs:{variant:"outline-primary"},on:{click:t.search}},[t._v("搜尋")])],1)],1),r("b-row",[r("b-col",t._l(t.errorPoints,(function(e,n){return r("b-card",{key:n,staticClass:"my-card"},[r("b-row",{attrs:{"align-v":"center"}},[r("b-col",[r("pre",[t._v("異常發生時間 "+t._s(t.human(e.created_at)))]),r("pre",[t._v("輸出開路次數: "+t._s(e.light_source_open_count))]),r("pre",[t._v("輸出短路次數: "+t._s(e.light_source_short_count))]),r("pre",[t._v("光源過熱關閉次數: "+t._s(e.light_source_thermal_shutdown_count))]),r("pre",[t._v("光源降載次數: "+t._s(e.light_source_thermal_derating_count))])]),r("b-col",{attrs:{cols:"1"}},[t.checkPoint?r("b-button",{on:{click:function(e){t.checkPoint=null}}},[t._v("Close")]):t._e()],1),r("b-col",{attrs:{cols:"1"}},[t.checkPoint?r("b-button",{attrs:{variant:"outline-primary"},on:{click:function(r){return t.startAnalysis(e,-1)}}},[t._v("往前一天")]):t._e()],1),r("b-col",{attrs:{cols:"1"}},[t.checkPoint?r("b-button",{attrs:{variant:"outline-primary"},on:{click:function(r){return t.startAnalysis(e,1)}}},[t._v("往後一天")]):t._e()],1),r("b-col",{attrs:{cols:"1"}},[r("b-button",{attrs:{variant:"outline-primary"},on:{click:function(r){return t.startAnalysis(e,0)}}},[t._v("檢查")])],1)],1),t.checkPoint===e?r("b-overlay",{staticClass:"card",attrs:{show:t.loading}},[r("b-row",[r("b-col",[r("LineChart",{attrs:{"chart-data":t.dayChartData,options:t.dayChartOptions}})],1)],1),r("b-row",[r("b-col",{attrs:{cols:""}},[r("LineChart",{attrs:{"chart-data":t.hourChartData,options:t.hourChartOptions}})],1)],1)],1):t._e()],1)})),1)],1),t.errorPoints&&0===t.errorPoints.length?r("b-row",[r("b-col",[r("b-card",{staticClass:"text-center"},[t._v("指定時間內無發生異常")])],1)],1):t._e()],1)}),[],!1,null,"2769c6e5",null);e.default=component.exports;installComponents(component,{LineChart:r(227).default})}}]);