(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{245:function(t,e,r){"use strict";r.d(e,"c",(function(){return h})),r.d(e,"b",(function(){return y})),r.d(e,"i",(function(){return _})),r.d(e,"a",(function(){return v})),r.d(e,"d",(function(){return x})),r.d(e,"e",(function(){return M})),r.d(e,"f",(function(){return C})),r.d(e,"j",(function(){return D})),r.d(e,"g",(function(){return w})),r.d(e,"h",(function(){return k}));r(66),r(11),r(51),r(60),r(32),r(33),r(86);var n=r(43),o=(r(12),r(10),r(110),r(111),r(25),r(244)),l=r.n(o),c=r(247);function d(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return l=t.done,t},e:function(t){c=!0,o=t},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var h=["#cd256f","#ef9424","#20a7d9","#79b045","#89328a","#086db0","#c7def8","#fc2929","#fad8c7","#fbca04","#84b6eb","#00cccc","#159818","#eb6420","#bfe5bf","#f7c6c7","#d4c5f9","#cc317c","#207de5","#b1eadc"],y=[{name:"總輸入功率",key:"active_power",diffMode:!1,sumary:!0},{name:"總輸出功率",key:"loadside_power",diffMode:!1,sumary:!0},{name:"總視在功率",key:"apparent_power",diffMode:!1,sumary:!0},{name:"平均亮度",key:"device_arc",diffMode:!1,sumary:!1},{name:"平均使用時間率",key:"light_source_on_time",diffMode:!0,sumary:!1},{name:"平均能耗使用率(輸出)",key:"output_usage",diffMode:!1,sumary:!0},{name:"平均能耗使用率(輸入)",key:"input_usage",diffMode:!1,sumary:!0},{name:"啟動總次數",key:"light_source_start_count",diffMode:!0,sumary:!1},{name:"驅動器最高溫度",key:"control_gear_temperature",sumary:!1,maxMode:!0},{name:"平均頻率",key:"control_gear_voltage_frequence",sumary:!1},{name:"平均輸入電壓",key:"control_gear_voltage",sumary:!1},{name:"平均功率因數",key:"control_gear_power_factor",sumary:!1}];function m(t,e,r){var n=l()(e.created_at),o=l()(t.created_at),c=l.a.duration(o.diff(n)).asSeconds();return Math.min(100,100*(t[r]-e[r])/c)}function _(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],f=0,_={datasets:[]},v=r.gears.map((function(g){return g.id})),x=v.reduce((function(e,r){return t[e].length>t[r].length?e:r})),M=v.length,C=r.gears.map((function(g){return g.power_out})).reduce((function(a,b){return a+b})),D=r.gears.map((function(g){return g.power_in})).reduce((function(a,b){return a+b})),w=d(y);try{for(w.s();!(e=w.n()).done;){var k,O=e.value,A=O.name,Y=O.key,I=O.sumary,j=O.diffMode,F=O.maxMode,S=O.yAxisID,H=[],P=d(t[x].entries());try{for(P.s();!(k=P.n()).done;){var R=Object(n.a)(k.value,2),T=R[0],E=R[1],L=l()(E.created_at),$=T+1;if(t[x][$]){var z,J=[],W=0,U=d(v);try{for(U.s();!(z=U.n()).done;){var B=z.value,G=t[B][T],K=t[B][$];if(G&&K){J.push(G[Y]);var N=G[Y];j&&(N=G[Y]-K[Y]),Y.includes("on_time")&&(N=m(G,K,Y)),"device_arc"===Y&&(N=c.a[N]),"output_usage"===Y&&(N=G.loadside_power),"input_usage"===Y&&(N=G.active_power),W+=N}}}catch(t){U.e(t)}finally{U.f()}var Q=W;I||(Q=W/M),"output_usage"===Y&&(Q=W/C*100),"input_usage"===Y&&(Q=W/D*100),F&&(Q=Math.max.apply(Math,J)),H.push({x:L.format(),y:Q.toFixed(2)})}}}catch(t){P.e(t)}finally{P.f()}o.includes(f)?f++:_.datasets.push({yAxisID:S,label:A,fill:!1,tension:0,borderColor:h[f++],data:[].concat(H)})}}catch(t){w.e(t)}finally{w.f()}return _}var v=["輸入耗能","視在耗能","負載耗能","平均啟動次數","平均使用率","平均亮度"];function x(t,e,r){var n,o=e.gears.map((function(g){return g.id})),c=o.reduce((function(e,r){return t[e].length>t[r].length?e:r})),f=[],y=[],_=[],v=[],x=[],M=[],C=!0,D=d(t[c]);try{var w=function(){var e=n.value;if(C)return C=!1,"continue";var r,c=l()(e.created_at),h=l()(e.created_at).subtract(1,"day"),D={l0:0,l1:0,l2:0},w=0,k=0,O=0,A=d(o);try{for(A.s();!(r=A.n()).done;){var Y=r.value,I=t[Y].find((function(t){return c.isSame(t.created_at,"day")})),j=t[Y].find((function(t){return h.isSame(t.created_at,"day")}));I&&j&&(D.l0+=I.active_energy-j.active_energy,D.l1+=I.apparent_energy-j.apparent_energy,D.l2+=I.loadside_energy-j.loadside_energy,w+=m(I,j,"light_source_on_time"),k+=I.light_source_start_count-j.light_source_start_count,O+=I.device_arc)}}catch(t){A.e(t)}finally{A.f()}f.push({x:c.format("YYYY-MM-DD"),y:(D.l0/o.length).toFixed(2)}),y.push({x:c.format("YYYY-MM-DD"),y:(D.l1/o.length).toFixed(2)}),_.push({x:c.format("YYYY-MM-DD"),y:(D.l2/o.length).toFixed(2)}),v.push({x:c.format("YYYY-MM-DD"),y:(k/o.length).toFixed(0)}),x.push({x:c.format("YYYY-MM-DD"),y:(w/o.length).toFixed(0)}),M.push({x:c.format("YYYY-MM-DD"),y:(O/o.length).toFixed(2)})};for(D.s();!(n=D.n()).done;)w()}catch(t){D.e(t)}finally{D.f()}return{datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入耗能",data:f},{yAxisID:"a",borderColor:h[1],fill:!1,tension:0,label:"視在耗能",data:y},{yAxisID:"a",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:_},{yAxisID:"d",borderColor:h[3],fill:!1,tension:0,label:"平均啟動次數",data:v},{yAxisID:"e",borderColor:h[4],fill:!1,tension:0,label:"平均使用率",data:x},{yAxisID:"f",borderColor:h[5],fill:!1,tension:0,label:"平均亮度",data:M}].filter((function(t,e){return!r.includes(e)}))}}function M(t,e,r,n){var o=e.gears.map((function(g){return g.id})),l=[],c=Array(24).keys();r&&(c=Array(7).keys());var f,y=[],m=[],_=[],v=[],x=[],M=[],C=d(c);try{for(C.s();!(f=C.n()).done;){var D=f.value;l.push(D);var w,k={l0:0,l1:0,l2:0},O=0,A=0,Y=0,I=d(o);try{for(I.s();!(w=I.n()).done;){var j=w.value;t[j]&&(k.l0+=t[j][D].active_energy,k.l1+=t[j][D].apparent_energy,k.l2+=t[j][D].loadside_energy,O+=t[j][D].light_source_on_time,A+=t[j][D].light_source_start_count,Y+=t[j][D].device_arc)}}catch(t){I.e(t)}finally{I.f()}y.push((k.l0/o.length).toFixed(2)),m.push((k.l1/o.length).toFixed(2)),_.push((k.l2/o.length).toFixed(2)),v.push((A/o.length).toFixed(0)),x.push((O/o.length).toFixed(0)),M.push((Y/o.length).toFixed(2))}}catch(t){C.e(t)}finally{C.f()}return r&&(l=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"]),{labels:l,datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入耗能",data:y},{yAxisID:"a",borderColor:h[1],fill:!1,tension:0,label:"視在耗能",data:m},{yAxisID:"a",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:_},{yAxisID:"d",borderColor:h[3],fill:!1,tension:0,label:"平均啟動次數",data:v},{yAxisID:"e",borderColor:h[4],fill:!1,tension:0,label:"平均使用率",data:x},{yAxisID:"f",borderColor:h[5],fill:!1,tension:0,label:"平均亮度",data:M}].filter((function(t,e){return!n.includes(e)}))}}function C(t,e){var r=[],n=0,o=e?{device_arc:"　亮度　",light_source_voltage:"　輸出電壓　",light_source_current:"　輸出電流　",light_source_temperature:"　光源溫度　",light_source_start_count:"　輸出啟動次數　",light_source_on_time:"　輸出啟動時間　"}:{light_source_faiture_count:"輸出錯誤次數",light_source_short_count:"輸出短路次數",light_source_open_count:"輸出開路次數",light_source_thermal_derating_count:"光源降載次數",light_source_thermal_shutdown_count:"光源過熱關閉次數"},d=function(d){var label=o[d],f=[];t.forEach((function(e,i){if(t[i+1]){var r=l()(e.created_at),n=e[d];"device_arc"===d&&(n=c.a[n]),f.push({x:r.format(),y:n})}}));var m={label:label,fill:!1,tension:0,borderColor:h[n++],data:[].concat(f)};e&&(m.yAxisID=y[n].yAxisID),r.push(m)};for(var f in o)d(f);return{datasets:r}}var D=["輸入電壓","輸入電壓頻率","負載耗能"];function w(t,e,r){var n,o=e.gears.map((function(g){return g.id})),c=o.reduce((function(e,r){return t[e].length>t[r].length?e:r})),f=[],y=[],m=[],_=0,v=d(t[c]);try{var x=function(){var e,r=n.value,c=l()(r.created_at),h={l0:0,l1:0,l2:0},v=d(o);try{for(v.s();!(e=v.n()).done;){var x=e.value,M=t[x].find((function(t){return c.isSame(t.created_at,"day")}));M&&(h.l0+=M.control_gear_voltage,h.l1+=M.control_gear_voltage_frequence,h.l2+=M.loadside_energy)}}catch(t){v.e(t)}finally{v.f()}f.push({x:c.format("YYYY-MM-DD"),y:(h.l0/o.length).toFixed(2)}),y.push({x:c.format("YYYY-MM-DD"),y:(h.l1/o.length).toFixed(2)});var C=h.l2/o.length,D=C-_;_=C,m.push({x:c.format("YYYY-MM-DD"),y:D.toFixed(2)})};for(v.s();!(n=v.n()).done;)x()}catch(t){v.e(t)}finally{v.f()}y.shift(),m.shift(),f.shift();var M={datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入電壓",data:f},{yAxisID:"b",borderColor:h[1],fill:!1,tension:0,label:"輸入電壓頻率",data:y},{yAxisID:"c",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:m}]};return M.datasets=M.datasets.filter((function(t,e){return!r.includes(e)})),M}function k(t,e,r,n){var o=e.gears.map((function(g){return g.id})),l=[],c=Array(24).keys();r&&(c=Array(7).keys());var f,y=[],m=[],_=[],v=d(c);try{for(v.s();!(f=v.n()).done;){var x=f.value;l.push(x);var M,C={l0:0,l1:0,l2:0},D=d(o);try{for(D.s();!(M=D.n()).done;){var w=M.value;t[w]&&(C.l0+=t[w][x].control_gear_voltage,C.l1+=t[w][x].control_gear_voltage_frequence,C.l2+=t[w][x].loadside_energy)}}catch(t){D.e(t)}finally{D.f()}y.push((C.l0/o.length).toFixed(2)),m.push((C.l1/o.length).toFixed(2)),_.push((C.l2/o.length).toFixed(2))}}catch(t){v.e(t)}finally{v.f()}return r&&(l=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"]),{labels:l,datasets:[{yAxisID:"a",borderColor:h[0],fill:!1,tension:0,label:"輸入電壓",data:y},{yAxisID:"b",borderColor:h[1],fill:!1,tension:0,label:"輸入電壓頻率",data:m},{yAxisID:"c",borderColor:h[2],fill:!1,tension:0,label:"負載耗能",data:_}].filter((function(t,e){return!n.includes(e)}))}}},246:function(t,e,r){"use strict";r.r(e);var n=r(248),o=(r(245),{mixins:[n.c.reactiveProp],extends:n.b,props:["options"],mounted:function(){this.renderLineChart()},methods:{renderLineChart:function(){this.renderChart(this.chartData,this.options)}},watch:{options:{deep:!0,handler:function(){this.renderChart(this.chartData,this.options)}}}}),l=r(50),component=Object(l.a)(o,void 0,void 0,!1,null,null,null);e.default=component.exports},255:function(t,e,r){var content=r(410);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(68).default)("66a2e188",content,!0,{sourceMap:!1})},256:function(t,e,r){var content=r(412);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(68).default)("3f7fcd9a",content,!0,{sourceMap:!1})},409:function(t,e,r){"use strict";var n=r(255);r.n(n).a},410:function(t,e,r){(e=r(67)(!1)).push([t.i,".dropdown-menu{background-color:none;background-clip:none;border:none;padding:0}",""]),t.exports=e},411:function(t,e,r){"use strict";var n=r(256);r.n(n).a},412:function(t,e,r){(e=r(67)(!1)).push([t.i,".spliter[data-v-6235ff99]{padding-top:20px}.card[data-v-6235ff99]{margin:10px 0;box-shadow:0 4px 8px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}.m-dropdown[data-v-6235ff99]{background-color:#2d2d2d;color:#fff;border-radius:8px;padding:12px 15px;margin-top:-25px;z-index:1;opacity:.9;font-size:14px;line-height:24px}.mbtn[data-v-6235ff99]{margin:0 10px}.colorRec[data-v-6235ff99]{margin-top:15px;height:26px;width:100%}.disable[data-v-6235ff99]{-webkit-filter:grayscale(1);filter:grayscale(1);text-decoration:line-through}",""]),t.exports=e},434:function(t,e,r){"use strict";r.r(e);r(14),r(11),r(12),r(13),r(61);var n=r(22),o=r(1),l=(r(25),r(10),r(245)),c=r(74);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function f(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}function h(t){return new Promise((function(e){return setTimeout(e,1e3*t)}))}var y={data:function(){return{loading:!0,minuteMode:!1,chartdataloaded:{},showDropdown:!1,colors:l.c,chartControlOptions:l.b.map((function(t){return{name:t.name,checked:!0}})),historyMinuteData:{}}},computed:f(f({},Object(c.b)(["regions","status","config","historyHour"])),{},{chartOptions:function(){var t=this;return{animation:{duration:0},responsive:!0,maintainAspectRatio:!1,legend:{display:!1,position:"right",align:"end"},title:{display:!0,text:"分析圖",fontSize:16},scales:{yAxes:l.b.map((function(e,r){return{id:e.yAxisID,display:1===t.chartControlOptions.filter((function(t,i){return t.checked})).length&&t.chartControlOptions[r].checked}})),xAxes:[{type:"time",distribution:"series",time:{unit:"hour"}}]}}},region:function(){return this.regions[this.region_index]||{}},region_index:function(){return this.$route.hash.substring(1)},disables:function(){return this.chartControlOptions.map((function(t,e){return t.checked?255:e})).filter((function(t){return t<255}))},showLegend:function(){return 1===this.chartControlOptions.filter((function(t,i){return t.checked}))}}),watch:{region_index:function(){this.minuteMode?this.updateHistoryMinute():this.renderHourChart()}},methods:{changeMode:function(){this.minuteMode=!this.minuteMode,this.minuteMode?(this.itv=setInterval(this.updateHistoryMinute,6e4),this.updateHistoryMinute()):this.renderHourChart()},renderHourChart:function(){this.chartOptions.title.text="24小時內變化圖",this.chartOptions.scales.xAxes[0].time.unit="hour",this.chartdataloaded=Object(l.i)(this.historyHour,this.regions[this.region_index],this.disables)},renderMinuteChart:function(){this.chartOptions.title.text="即時變化圖",this.chartOptions.scales.xAxes[0].time.unit="minute",this.chartdataloaded=Object(l.i)(this.historyMinuteData,this.regions[this.region_index],this.disables)},updateHistoryMinute:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$axios.get("history",{params:{config_id:t.config.id,step:"minute"}});case 3:r=e.sent,n=r.data,t.loading=!1,t.historyMinuteData=n,t.minuteMode&&t.renderMinuteChart();case 8:case"end":return e.stop()}}),e)})))()},toggle:function(){setTimeout(this.reChart)},reChart:function(){this.minuteMode?this.renderMinuteChart():this.renderHourChart()}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object.keys(t.historyHour).length&&t.regions.length){e.next=6;break}return console.log("sleep"),e.next=4,h(1);case 4:e.next=0;break;case 6:t.loading=!1,t.renderHourChart();case 8:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){console.log("should leave and destory interval"),clearInterval(this.itv)}},m=(r(409),r(411),r(50)),component=Object(m.a)(y,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("b-row",{staticClass:"mt-3"},[r("b-col",[r("h2",[t._v(t._s(t.config.name)+" > "+t._s(t.region.name))])]),r("b-col",{attrs:{cols:"3","align-h":"center"}},[r("b-button",{staticClass:"mbtn",attrs:{variant:"warning"},on:{click:t.changeMode}},[t._v(t._s(t.minuteMode?"即時":"24小時"))]),r("b-dropdown",{staticClass:"m-2",attrs:{text:"顯示項目",variant:"warning"}},[r("b-dropdown-form"),r("div",{staticClass:"m-dropdown"},t._l(t.chartControlOptions,(function(e,n){return r("div",{key:n},[r("b-form-checkbox",{on:{change:t.toggle},model:{value:e.checked,callback:function(r){t.$set(e,"checked",r)},expression:"cl.checked"}},[t._v(t._s(e.name))])],1)})),0)],1)],1)],1),r("b-row",[r("b-col",[r("b-overlay",{attrs:{show:t.loading}},[r("b-card",{staticClass:"card"},[r("LineChart",{attrs:{"chart-data":t.chartdataloaded,options:t.chartOptions}})],1)],1)],1)],1),r("b-row",{staticClass:"legend"},t._l(t.chartControlOptions,(function(e,n){return t.disables.includes(n)?t._e():r("b-col",{key:n,attrs:{cols:"2"}},[r("div",{staticClass:"colorRec",style:{"background-color":t.colors[n]}}),r("div",{staticClass:"text-center"},[t._v(t._s(e.name))])])})),1)],1)}),[],!1,null,"6235ff99",null);e.default=component.exports;installComponents(component,{LineChart:r(246).default})}}]);